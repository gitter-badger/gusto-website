function getMediaQuery(){var t=parseInt($stateIndicator.css("z-index"));return t>0&&2>=t?"small":t>2&&4>=t?"medium":"large"}function scrollToPos(t,e){e=void 0==e?500:e,$("html, body").animate({scrollTop:$(t).offset().top-50},e,"swing",function(){window.location.hash=t})}function companyTimeline(){$("[data-company]").each(function(t){var e=$(this).attr("data-company"),a=e.indexOf(","),i=e.substring(0,a),n=e.substring(a+1);$timeline.append($("<div>").addClass("company wow fadeInLeft "+i).append($("<p>").addClass("date").html(n).css("left",-10*t)))})}function companyTimelineHeight(){$timeline.css("height",height),$("[data-company]").each(function(){var t=$(this).attr("data-company"),e=t.substring(0,t.indexOf(","));$timeline.find("."+e).css("margin-top",$(this).offset().top).css("height",height-$(this).offset().top)})}function d3NodePaths(){function t(){$("[data-stop]").each(function(){var t=$(this),e=t.attr("data-stop"),a=e.split(",");$.each(a,function(e,a){function n(t){return[u+l*Math.sin(t),f+l*Math.cos(t)]}var r=a.indexOf("-"),o=a.substring(r+1),s=a.substring(0,r),d=t.offset(),c=t.outerWidth(),h=t.outerHeight(),p=[];if("left-circle"!==a&&"right-circle"!==a)"left"===o?p.push(d.left):"center"===o?p.push(d.left+c/2):"right"===o&&p.push(d.left+c),"top"===s?p.push(d.top):"middle"===s?p.push(d.top+h/2):"bottom"===s&&p.push(d.top+h),i.push(p);else{var l=c/2,u=d.left+c/2,f=d.top+h/2;"left-circle"===a?i.push(n(-90),n(-45),n(0),n(45),n(90),n(135),n(180),n(225),n(270)):"right-circle"===a&&i.push(n(90),n(45),n(0),n(-45),n(-90),n(-135),n(-180),n(-225),n(-270))}})})}function e(){var t=s[0][0],e=t.getTotalLength(),a=height-windowHeight,i=scrollPos/a,n=i*e,r=scrollPos+windowHeight/2-t.getPointAtLength(n).y,o=1;windowWidth>=1200&&1400>windowWidth?o=1.1:windowWidth>=1400&&(o=1.2);var c=n+o*r;t.style.strokeDasharray=[c,e].join(" ");var h=t.getPointAtLength(c);d.attr("cx",h.x).attr("cy",h.y)}var a=d3.select("body").append("svg").attr("width",width).attr("height",height).attr("id","trail");$svg=$("#trail");var i=[];t();var n=d3.svg.line().interpolate("basis"),r=a.append("g").attr("id","trail-hold"),o=r.append("path").datum(i).attr("id","gray-path").attr("class","line animated fadeIn").attr("d",n),s=r.append("path").datum(i).attr("id","red-path").attr("class","line").attr("d",n),d=r.append("circle").attr("id","node").attr("r",12).attr("cx",0).attr("cy",0);e(),$(window).scroll(_.throttle(function(){e()},10)).resize(_.throttle(function(){a.attr("width",windowWidth).attr("height",height)},10)).resize(_.debounce(function(){i=[],t(),o.datum(i).attr("d",n),s.datum(i).attr("d",n),e()},100))}function d3StatGraphs(){$(".stat-graphs").each(function(){$(this).children("li").each(function(t){var e=$(this),a=e.width(),i=a,n=Math.min(a,i)/2;e.css("height",i+100);var r=d3.svg.arc().outerRadius(n-10).innerRadius(0),o=d3.layout.pie().sort(null).value(function(t){return t.val}),s=+e.attr("data-value"),d=100-s,c=[{val:s},{val:d}],h=d3.select(this).append("svg").attr("width",a).attr("height",i).attr("class","graph-"+(t+1)).attr("viewBox","0 0 "+a+" "+i).attr("preserveAspectRatio","xMidYMid").append("g").attr("transform","translate("+a/2+","+i/2+")"),p=h.selectAll(".arc").data(o(c)).enter().append("g").attr("class","arc");p.append("path").attr("d",r),e.append($("<p>").html(e.attr("data-label"))),$(window).resize(_.throttle(function(){a=e.width(),i=a,e.css("height",i+100),e.find("svg").attr("width",a).attr("height",i)},10))})})}function d3PongGame(){function t(){b.attr("x",d-x).attr("y",c/2-y/2),I.attr("x",x).attr("y",c/2-y/2),M.attr("cx",d/2).attr("cy",c/2)}function e(e){"user"==e&&m.user+1<=3?m.user++:"gusto"==e&&m.gusto+1<=3&&m.gusto++,k.text(m.user+" - "+m.gusto),t(),f=0,(3==m.user||3==m.gusto)&&(s(),3==m.user?p.parent().next().find("h4").text("Very good, Young Pongawan!"):3==m.gusto&&p.parent().next().find("h4").text("Did you find the keyboard?"),p.fadeOut(500,function(){$(this).parent().next().addClass("winner"),$(window).trigger("resize")}))}function a(t,e){M.attr("dx",t).attr("dy",e)}function i(){var t=parseInt(M.attr("cx")),i=parseInt(M.attr("cy")),n=parseInt(I.attr("x")),r=parseInt(I.attr("y")),o=parseInt(b.attr("x")),s=parseInt(b.attr("y")),h=parseInt(M.attr("dx")),p=parseInt(M.attr("dy"));(n+v+w>=t&&i>=r-w&&r+y+w>=i||t>=o-w&&i>=s-w&&s+y+w>=i)&&a(-1*h,p),(w>=i||i>=c-w)&&a(h,-1*p),w>=t?e("gusto"):t>=d-w&&e("user")}function n(){M.attr("cx",parseInt(M.attr("dx"))+parseInt(M.attr("cx"))).attr("cy",parseInt(M.attr("dy"))+parseInt(M.attr("cy")))}function r(){if(f++,f%3==0){var t=parseInt(M.attr("cx")),e=parseInt(M.attr("cy")),a=parseInt(b.attr("y")),i;i=e-w>=a?a+u:a-u,i>=0&&c>=i+y&&b.attr("y",i)}}function o(){z&&(n(),i(),r())}function s(){clearInterval(C),C=0}var d=.9*$(window).width(),c=500,h=d3.select("#pong").append("svg").attr("width",d).attr("height",c).attr("viewBox","0 0 "+d+" "+c).attr("preserveAspectRatio","xMidYMid"),p=$("#pong svg"),l=!1,u=5,f=0,g=12,w=g+4,m={user:0,gusto:0},v=10,y=60,x=10,b=h.append("rect").attr("width",v).attr("height",y).attr("rx",5).attr("ry",5),I=h.append("rect").attr("width",v).attr("height",y).attr("rx",5).attr("ry",5),P=h.append("text").attr("x",40).attr("y",c-20).attr("class","instructions").text("W = Up / S = Down"),k=h.append("text").attr("x",d/2).attr("y",c-60).attr("class","score").attr("text-anchor","middle"),T=h.append("text").attr("x",d/2).attr("y",c-20).attr("class","rules").attr("text-anchor","middle").text("First to 3 games"),M=h.append("circle").attr("r",g);p.parent().append($("<div>").addClass("modal")).append($("<p>").addClass("button radius secondary").text("Let's play some pong!"));var z=!1,C=setInterval(o,5);t(),e(),a(-2,-2),p.parent().find(".button").on("click",function(){p.parent().find(".modal, .button").fadeOut(500,function(){z=!0})}),p.on("mouseenter",function(){l=!0}).on("mouseleave",function(){l=!1}),d3.select("body").on("keydown",function(){if(l){var t=2*u;if(87==d3.event.keyCode){var e=parseInt(I.attr("y"));e-t>=0&&I.attr("y",e-t)}else if(83==d3.event.keyCode){var e=parseInt(I.attr("y"));c>=e+y+t&&I.attr("y",e+t)}}}),$(window).resize(_.throttle(function(){p.attr("width",d=.9*$(window).width()).attr("height",500)},10))}var $footer=$("#footer"),$stateIndicator=$(".state-indicator"),$svg=$("#trail"),$timeline=$("#timeline");width=$(document).width(),height=$footer.offset().top+$footer.outerHeight(!0)+8,aspect=width/height,scrollPos=$(window).scrollTop(),windowWidth=$(window).width(),windowHeight=$(window).height(),$(document).foundation(),$(document).ready(function(){$("a").on("click",function(t){var e=$(this).attr("href");-1!=e.indexOf("#")&&(t.preventDefault(),scrollToPos(e))}),companyTimeline(),companyTimelineHeight(),$("[data-section]").waypoint(function(){var t=$(this).attr("id");history.pushState(null,"","#"+t),document.title="gusto"!==t?"Gusto is "+t.replace(/-/g," ").capitalize()+" | Build your idea with Gusto":"We are "+t.replace(/-/g," ").capitalize()+" | Build your idea with Gusto"},{offset:function(){return $(this).index()>0?50:0}}),$(".headturn").on("mousemove",function(t){var e=$(this).width(),a=e/5,i=t.pageX-$(this).offset().left;i>=0&&a>i?$(this).css("background-position","0px 0px"):i>=1*a&&2*a>i?$(this).css("background-position",-1*e+"px 0px"):i>=2*a&&3*a>i?$(this).css("background-position",-2*e+"px 0px"):i>=3*a&&4*a>i?$(this).css("background-position",-3*e+"px 0px"):$(this).css("background-position",-4*e+"px 0px")}).on("mouseleave",function(){var t=$(this).width();$(this).css("background-position",-2*t+"px 0px")}),d3StatGraphs(),d3PongGame(),$("#contact-form").on("submit",function(t){t.preventDefault();var e=$(this).find("[name=name]"),a=$(this).find("[name=email]"),i=$(this).find("[name=message]"),n=$(this).find("[name=submit]");$.ajax({type:"POST",url:"https://mandrillapp.com/api/1.0/messages/send.json",data:{key:"ZeY-CdysVOD7M47CJYPkSQ",message:{from_email:a.val(),from_name:e.val(),headers:{"Reply-To":a.val()},to:[{email:"contact@gusto.is",name:"Gusto",type:"to"}],autotext:"true",subject:"Talk with Gusto",text:i.val()}}}).done(function(t){e.val(""),a.val(""),i.val("")})})}),$(window).load(function(){"small"!=getMediaQuery()&&d3NodePaths(),$(window).trigger("resize")}).scroll(function(){scrollPos=$(window).scrollTop()}).resize(function(){width=$(document).width(),height=$footer.offset().top+$footer.outerHeight(!0),aspect=width/height,scrollPos=$(window).scrollTop(),windowWidth=$(window).width(),windowHeight=$(window).height(),$svg=$("#trail"),"small"!=getMediaQuery()&&1!=$svg.length?d3NodePaths():"small"==getMediaQuery()&&$svg.remove(),companyTimelineHeight()}),String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})};