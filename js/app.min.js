function getMediaQuery(){var t=parseInt($stateIndicator.css("z-index"));return t>0&&2>=t?"small":t>2&&4>=t?"medium":"large"}function scrollToPos(t,a){a=void 0==a?500:a;var e=$(t).offset().top;$(t).offset().top<$(window).scrollTop()&&(e-=60),$("html, body").animate({scrollTop:e},a,"swing")}function companyTimeline(){$("[data-company]").each(function(t){var a=$(this).attr("data-company"),e=a.indexOf(","),i=a.substring(0,e),n=a.substring(e+1);$timeline.append($("<div>").addClass("company "+i).append($("<p>").addClass("date").html(n).css("left",-10*t)))})}function companyTimelineHeight(){$timeline.css("height",height),$("[data-company]").each(function(){var t=$(this).attr("data-company"),a=t.substring(0,t.indexOf(","));$timeline.find("."+a).css("margin-top",$(this).offset().top).css("height",height-$(this).offset().top)})}function d3NodePaths(){function t(){$("[data-stop]").each(function(){var t=$(this),a=t.attr("data-stop"),e=a.split(",");$.each(e,function(a,e){function n(t){return[u+l*Math.sin(t),f+l*Math.cos(t)]}var r=e.indexOf("-"),o=e.substring(r+1),s=e.substring(0,r),d=t.offset(),h=t.outerWidth(),c=t.outerHeight(),p=[];if("left-circle"!==e&&"right-circle"!==e)"left"===o?p.push(d.left):"center"===o?p.push(d.left+h/2):"right"===o&&p.push(d.left+h),"top"===s?p.push(d.top):"middle"===s?p.push(d.top+c/2):"bottom"===s&&p.push(d.top+c),i.push(p);else{var l=h/2,u=d.left+h/2,f=d.top+c/2;"left-circle"===e?i.push(n(-90),n(-45),n(0),n(45),n(90),n(135),n(180),n(225),n(270)):"right-circle"===e&&i.push(n(90),n(45),n(0),n(-45),n(-90),n(-135),n(-180),n(-225),n(-270))}})})}function a(){var t=s[0][0],a=t.getTotalLength(),e=height-windowHeight,i=scrollPos/e,n=i*a,r=scrollPos+windowHeight/2-t.getPointAtLength(n).y,o=1;windowWidth>=1200&&1400>windowWidth?o=1.1:windowWidth>=1400&&(o=1.2);var h=n+o*r;t.style.strokeDasharray=[h,a].join(" ");var c=t.getPointAtLength(h);d.attr("cx",c.x).attr("cy",c.y)}var e=d3.select("body").append("svg").attr("width",width).attr("height",height).attr("id","trail");$svg=$("#trail");var i=[];t();var n=d3.svg.line().interpolate("basis"),r=e.append("g").attr("id","trail-hold"),o=r.append("path").datum(i).attr("id","gray-path").attr("class","line animated fadeIn").attr("d",n),s=r.append("path").datum(i).attr("id","red-path").attr("class","line").attr("d",n),d=r.append("circle").attr("id","node").attr("r",12).attr("cx",0).attr("cy",0);a(),$(window).scroll(_.throttle(function(){a()},10)).resize(_.throttle(function(){e.attr("width",windowWidth).attr("height",height)},10)).resize(_.debounce(function(){i=[],t(),o.datum(i).attr("d",n),s.datum(i).attr("d",n),a()},100))}function d3StatGraphs(){$(".stat-graphs").each(function(){$(this).children("li").each(function(t){var a=$(this),e=a.width(),i=e,n=Math.min(e,i)/2;a.css("height",i+100);var r=d3.svg.arc().outerRadius(n-10).innerRadius(0),o=d3.layout.pie().sort(null).value(function(t){return t.val}),s=+a.attr("data-value"),d=100-s,h=[{val:s},{val:d}],c=d3.select(this).append("svg").attr("width",e).attr("height",i).attr("class","graph-"+(t+1)).attr("viewBox","0 0 "+e+" "+i).attr("preserveAspectRatio","xMidYMid").append("g").attr("transform","translate("+e/2+","+i/2+")"),p=c.selectAll(".arc").data(o(h)).enter().append("g").attr("class","arc");p.append("path").attr("d",r),a.append($("<p>").html(a.attr("data-label"))),$(window).resize(_.throttle(function(){e=a.width(),i=e,a.css("height",i+100),a.find("svg").attr("width",e).attr("height",i)},10))})})}function d3PongGame(){function t(){b.attr("x",d-x).attr("y",h/2-y/2),I.attr("x",x).attr("y",h/2-y/2),M.attr("cx",d/2).attr("cy",h/2)}function a(a){"user"==a&&m.user+1<=3?m.user++:"gusto"==a&&m.gusto+1<=3&&m.gusto++,T.text(m.user+" - "+m.gusto),t(),f=0,(3==m.user||3==m.gusto)&&(s(),3==m.user?p.parent().next().find("h4").text("Very good, Young Pongawan!"):3==m.gusto&&p.parent().next().find("h4").text("Did you find the keyboard?"),p.fadeOut(500,function(){$(this).parent().next().addClass("winner"),$(window).trigger("resize")}))}function e(t,a){M.attr("dx",t).attr("dy",a)}function i(){var t=parseInt(M.attr("cx")),i=parseInt(M.attr("cy")),n=parseInt(I.attr("x")),r=parseInt(I.attr("y")),o=parseInt(b.attr("x")),s=parseInt(b.attr("y")),c=parseInt(M.attr("dx")),p=parseInt(M.attr("dy"));(n+v+w>=t&&i>=r-w&&r+y+w>=i||t>=o-w&&i>=s-w&&s+y+w>=i)&&e(-1*c,p),(w>=i||i>=h-w)&&e(c,-1*p),w>=t?a("gusto"):t>=d-w&&a("user")}function n(){M.attr("cx",parseInt(M.attr("dx"))+parseInt(M.attr("cx"))).attr("cy",parseInt(M.attr("dy"))+parseInt(M.attr("cy")))}function r(){if(f++,f%3==0){var t=parseInt(M.attr("cx")),a=parseInt(M.attr("cy")),e=parseInt(b.attr("y")),i;i=a-w>=e?e+u:e-u,i>=0&&h>=i+y&&b.attr("y",i)}}function o(){z&&(n(),i(),r())}function s(){clearInterval(C),C=0}var d=.9*$(window).width(),h=500,c=d3.select("#pong").append("svg").attr("width",d).attr("height",h).attr("viewBox","0 0 "+d+" "+h).attr("preserveAspectRatio","xMidYMid"),p=$("#pong svg"),l=!1,u=5,f=0,g=12,w=g+4,m={user:0,gusto:0},v=10,y=60,x=10,b=c.append("rect").attr("width",v).attr("height",y).attr("rx",5).attr("ry",5),I=c.append("rect").attr("width",v).attr("height",y).attr("rx",5).attr("ry",5),P=c.append("text").attr("x",40).attr("y",h-20).attr("class","instructions").text("W = Up / S = Down"),T=c.append("text").attr("x",d/2).attr("y",h-60).attr("class","score").attr("text-anchor","middle"),k=c.append("text").attr("x",d/2).attr("y",h-20).attr("class","rules").attr("text-anchor","middle").text("First to 3 games"),M=c.append("circle").attr("r",g);p.parent().append($("<div>").addClass("modal")).append($("<p>").addClass("button radius secondary").text("Let's play some pong!"));var z=!1,C=setInterval(o,5);t(),a(),e(-2,-2),p.parent().find(".button").on("click",function(){p.parent().find(".modal, .button").fadeOut(500,function(){z=!0})}),c.on("mousemove",function(){var t=d3.mouse(this);console.log(h),t[1]>0&&t[1]<h-y&&I.attr("y",t[1])}),$(window).resize(_.throttle(function(){p.attr("width",d=.9*$(window).width()).attr("height",500)},10))}var $header=$("#header"),$footer=$("#footer"),$stateIndicator=$(".state-indicator"),$svg=$("#trail"),$timeline=$("#timeline");width=$(document).width(),height=$footer.offset().top+$footer.outerHeight(!0)+8,aspect=width/height,scrollPos=$(window).scrollTop(),windowWidth=$(window).width(),windowHeight=$(window).height(),$(document).ready(function(){$(document).foundation(),100>=scrollPos&&$header.hide(),$("a").on("click",function(t){var a=$(this).attr("href");-1!=a.indexOf("#")&&(t.preventDefault(),$(this).parent().hasClass("menu-icon")||scrollToPos(a))}),null!=history.state&&scrollToPos("#"+history.state),companyTimeline(),companyTimelineHeight(),$("[data-section]").waypoint(function(){var t=$(this).attr("id");history.pushState(t,"",t),document.title="gusto"!==t?"Gusto is "+t.replace(/-/g," ").capitalize()+" | Build your idea with Gusto":"We are "+t.replace(/-/g," ").capitalize()+" | Build your idea with Gusto"},{offset:function(){return $(this).index()>0?50:0}}),$(".flyIn").waypoint(function(){$(this).addClass("go")},{offset:"100%"}),$(".headturn").on("mousemove",function(t){var a=$(this).width(),e=a/5,i=t.pageX-$(this).offset().left;i>=0&&e>i?$(this).css("background-position","0px 0px"):i>=1*e&&2*e>i?$(this).css("background-position",-1*a+"px 0px"):i>=2*e&&3*e>i?$(this).css("background-position",-2*a+"px 0px"):i>=3*e&&4*e>i?$(this).css("background-position",-3*a+"px 0px"):$(this).css("background-position",-4*a+"px 0px")}).on("mouseleave",function(){var t=$(this).width();$(this).css("background-position",-2*t+"px 0px")}),d3StatGraphs(),d3PongGame(),$("#contact-form").on("submit",function(t){t.preventDefault();var a=$(this).find("[name=name]"),e=$(this).find("[name=email]"),i=$(this).find("[name=message]"),n=$(this).find("[name=submit]");$.ajax({type:"POST",url:"https://mandrillapp.com/api/1.0/messages/send.json",data:{key:"ZeY-CdysVOD7M47CJYPkSQ",message:{from_email:e.val(),from_name:a.val(),headers:{"Reply-To":e.val()},to:[{email:"contact@gusto.is",name:"Gusto",type:"to"}],autotext:"true",subject:"Talk with Gusto",text:i.val()}}}).done(function(t){a.val(""),e.val(""),i.val("")})})}),$(window).load(function(){"small"!=getMediaQuery()&&d3NodePaths(),$(window).trigger("resize")}).scroll(function(){scrollPos=$(window).scrollTop(),100>=scrollPos?$header.fadeOut(250):$header.fadeIn(250)}).resize(function(){width=$(document).width(),height=$footer.offset().top+$footer.outerHeight(!0),aspect=width/height,scrollPos=$(window).scrollTop(),windowWidth=$(window).width(),windowHeight=$(window).height(),$svg=$("#trail"),"small"!=getMediaQuery()&&1!=$svg.length?d3NodePaths():"small"==getMediaQuery()&&$svg.remove(),companyTimelineHeight()}),String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})};